# 项目环境搭建
## 一、案例初始化

### 1.建立项目所需文件夹
- public 静态资源
- model 数据库操作
- route 路由
- views 模板

### 2.初始化项目描述文件
- npm init

### 3.下载项目所需第三方模块
- npm install express mongoose art-template express-art-template body-parser

### 4.创建网站服务器
- 引用express框架，创建网站服务器对象，监听端口

### 5.构建模块化路由
- 在route目录新建路由模块文件，引用express框架，创建路由对象，设置一级路由，导出路由对象
- 入口文件引用路由模块
- 拦截请求，匹配对应路由

### 6.构建博客管理页面模板
- 复制静态文件到public
- 开放静态资源文件
- 复制html文件到views，修改为art后缀
- 配置模板默认路径和后缀，以及art后缀模板使用的模板引擎
- 渲染模板
- 修改模板
  - 外链静态资源路径处理
    - 模板文件中，外链静态资源必须写绝对路径
    - 外链静态资源相对路径是相对客户端的请求路径，浏览器会把localhost/admin/login中的/admin当成相对目录，login当成文件，而css则是/admin下的文件
    - 若public和views下文件夹都叫admin，则可以访问到，但如果他们文件夹名字不同，则无法访问到
    - 加上/就代表绝对路径，这里就是public目录了，然后/admin或者/home
    - 可以先只改几个看看效果，之后抽离公共部分了再处理
  - 优化模板，抽离公共部分
    - 观察页面，找出重复的部分=》找到对应的代码
    - 新建common目录，新建art子模板，将公共代码剪切过来
    - {{include 子模板}}引入回来 （子模板相对路径就是相对当前文件，因为他是服务器端模板引擎来解析，而不是浏览器解析
    - 新建骨架模板，复制骨架，留坑，继承骨架模板，填坑


## 二、项目功能实现

### （一、登录
#### 1.创建用户集合，初始化用户
- 连接数据库
  - 在module文件夹新建connect.js，引用mongoose模块，连接blog数据库，然后入口里引入connect.js
- 创建用户集合
  - 同样新建user.js，引用xx模块，创建集合规则，根据业务需要设定字段，创建集合，导出集合（对象形式
- 初始化用户
  - 创建一个测试用户，入口导入模块测试一下，之后删掉或者注释掉相关代码

#### 2.为登录表单项设置请求地址，请求方式以及表单项name属性
- get方式不安全，用post
- 请求地址为/admin/login
#### 3.当用户点击登录按钮时，客户端验证用户是否填写了登录表单
- 在下面写前端验证的js代码
  - 首先获取到form的dom，阻止默认提交事件，用jQuery提供的serializeToJson()获取form信息
  - 写一个serializeToJson()来将信息转换为json格式
    - serializeToJson()返回值是对象数组，[{name: 'email', value: '输入的内容'}]，获取到他，然后遍历，将name对应的值设置为新对象的属性，然后将value对应的值赋值给这个属性
    - 返回新对象
    - 由于其他地方可能也用到这个函数，将其保存到public/admin/js/common.js，然后引入到骨架模板
#### 3.如果其中一项没有输入，阻止表单提交
  - 进行表单内容的一系列判断，如果不通过就return false阻止提交，同时给出提示信息
  - 当验证通过，则允许提交
#### 5.服务端接收请求参数，验证用户是否填写了登录表单
#### 6.如果其中一项没有输入，为客户端作出响应，阻止程序向下执行
#### 7.根据邮箱地址查询用户信息
#### 8.如果用户不存在，微客户端作出响应，阻止程序向下执行
#### 9.如果用户存在，将用户名和密码进行比对
#### 10.比对成功，用户登录成功
#### 11.比对失败，用户登录失败

### （二、项目包含的知识点
#### 1.密码加密 bcrypt
- 哈希加密是单程加密方式，但是可以比对密码库来暴力破解，所以要在加密的密码中加入随机字符串增加破解难度
- 安装模块和依赖环境
  - python 2.x
  - node-gyp 此模块需要全局安装 => npm i -g node-gyp
  - windows-build-tools 此模块需要用管理员权限的powershell全局安装 => npm i -g --production windows-build-tools
  - 然后安装bcrypt => npm i bcrypt

#### 2.cookie和session
- 安装express-session模块
- 导入模块，在登录成功的路由里，将用户名存储到req.session对象中
- 由于很多地方用到username，所以将user信息存到app.locals.userInfo开放给模板
- 注意，在修改文件后，服务器重启了，这时原有cookie会失效，需要重新登录获取新的cookie

#### 3.代码优化

懒得写了。。。